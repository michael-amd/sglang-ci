==========================================
SGL Unit Test Log
==========================================
Test: test_custom_allreduce.TestCustomAllReduce
Image: rocm/sgl-dev:v0.5.6.post2-rocm700-mi35x-20251212
Container: sgl-dev_v0.5.6.post2-rocm700-mi35x-20251212
Hardware: mi35x
Machine: smci355-ccs-aus-m12-33
Start time: 2025-12-12 10:03:51 CST
Test directory: /sgl-workspace/sglang/test/manual
Command: CUDA_VISIBLE_DEVICES=0,1,2,3,4,5,6,7 python3 -m unittest test_custom_allreduce.TestCustomAllReduce
==========================================

/opt/venv/lib/python3.10/site-packages/ray/_private/node.py:1204: ResourceWarning: unclosed file <_io.TextIOWrapper name='/dev/null' mode='w' encoding='UTF-8'>
  process_info = ray._private.services.start_gcs_server(
ResourceWarning: Enable tracemalloc to get the object allocation traceback
/opt/venv/lib/python3.10/site-packages/ray/_private/node.py:1414: ResourceWarning: unclosed file <_io.TextIOWrapper name='/tmp/ray/session_2025-12-12_16-03-55_288917_13/logs/monitor.out' mode='a' encoding='utf-8'>
  self.start_monitor()
ResourceWarning: Enable tracemalloc to get the object allocation traceback
/opt/venv/lib/python3.10/site-packages/ray/_private/node.py:1414: ResourceWarning: unclosed file <_io.TextIOWrapper name='/tmp/ray/session_2025-12-12_16-03-55_288917_13/logs/monitor.err' mode='a' encoding='utf-8'>
  self.start_monitor()
ResourceWarning: Enable tracemalloc to get the object allocation traceback
/opt/venv/lib/python3.10/site-packages/ray/_private/node.py:1425: ResourceWarning: unclosed file <_io.TextIOWrapper name='/tmp/ray/session_2025-12-12_16-03-55_288917_13/logs/dashboard.err' mode='a' encoding='utf-8'>
  self.start_api_server(
ResourceWarning: Enable tracemalloc to get the object allocation traceback
/opt/venv/lib/python3.10/site-packages/ray/_private/utils.py:521: ResourceWarning: unclosed file <_io.TextIOWrapper name='/sys/fs/cgroup/cpu.max' mode='r' encoding='UTF-8'>
  max_file = open(cpu_max_file_name).read()
ResourceWarning: Enable tracemalloc to get the object allocation traceback
/opt/venv/lib/python3.10/site-packages/ray/_private/node.py:1247: ResourceWarning: unclosed file <_io.TextIOWrapper name='/dev/null' mode='w' encoding='UTF-8'>
  process_info = ray._private.services.start_raylet(
ResourceWarning: Enable tracemalloc to get the object allocation traceback
/opt/venv/lib/python3.10/site-packages/ray/_private/node.py:1469: ResourceWarning: unclosed file <_io.TextIOWrapper name='/tmp/ray/session_2025-12-12_16-03-55_288917_13/logs/log_monitor.err' mode='a' encoding='utf-8'>
  self.start_log_monitor()
ResourceWarning: Enable tracemalloc to get the object allocation traceback
2025-12-12 16:03:56,334	INFO worker.py:1852 -- Started a local Ray instance.
[36m(eager_allreduce pid=648)[0m [2025-12-12 16:04:04] INFO pynccl.py:83: sglang is using nccl==2.26.6
[36m(eager_allreduce pid=648)[0m [aiter] start build [module_aiter_enum] under /sgl-workspace/aiter/aiter/jit/build/module_aiter_enum
[36m(eager_allreduce pid=648)[0m [2025-12-12 16:04:10] INFO core.py:524: start build [module_aiter_enum] under /sgl-workspace/aiter/aiter/jit/build/module_aiter_enum
[36m(eager_allreduce pid=633)[0m [aiter] waiting for baton release at /sgl-workspace/aiter/aiter/jit/build/lock_module_aiter_enum
[36m(eager_allreduce pid=633)[0m [2025-12-12 16:04:10] INFO file_baton.py:48: waiting for baton release at /sgl-workspace/aiter/aiter/jit/build/lock_module_aiter_enum
[36m(eager_allreduce pid=648)[0m [aiter] [32mfinish build [module_aiter_enum], cost 7.5s [0m
[36m(eager_allreduce pid=648)[0m [2025-12-12 16:04:17] INFO core.py:673: [32mfinish build [module_aiter_enum], cost 7.5s [0m
[36m(eager_allreduce pid=648)[0m [aiter] import [module_aiter_enum] under /sgl-workspace/aiter/aiter/jit/module_aiter_enum.so
[36m(eager_allreduce pid=648)[0m [2025-12-12 16:04:17] INFO core.py:477: import [module_aiter_enum] under /sgl-workspace/aiter/aiter/jit/module_aiter_enum.so
[36m(eager_allreduce pid=648)[0m [aiter] start build [module_custom_all_reduce] under /sgl-workspace/aiter/aiter/jit/build/module_custom_all_reduce
[36m(eager_allreduce pid=648)[0m [2025-12-12 16:04:17] INFO core.py:524: start build [module_custom_all_reduce] under /sgl-workspace/aiter/aiter/jit/build/module_custom_all_reduce
[36m(eager_allreduce pid=633)[0m [aiter] waiting for baton release at /sgl-workspace/aiter/aiter/jit/build/lock_module_custom_all_reduce
[36m(eager_allreduce pid=633)[0m [2025-12-12 16:04:18] INFO file_baton.py:48: waiting for baton release at /sgl-workspace/aiter/aiter/jit/build/lock_module_custom_all_reduce
[36m(eager_allreduce pid=648)[0m [aiter] [32mfinish build [module_custom_all_reduce], cost 19.5s [0m
[36m(eager_allreduce pid=648)[0m [2025-12-12 16:04:37] INFO core.py:673: [32mfinish build [module_custom_all_reduce], cost 19.5s [0m
[36m(eager_allreduce pid=648)[0m [aiter] import [module_custom_all_reduce] under /sgl-workspace/aiter/aiter/jit/module_custom_all_reduce.so
[36m(eager_allreduce pid=648)[0m [2025-12-12 16:04:37] INFO core.py:477: import [module_custom_all_reduce] under /sgl-workspace/aiter/aiter/jit/module_custom_all_reduce.so
[36m(eager_allreduce pid=648)[0m [2025-12-12 16:04:37] INFO custom_all_reduce.py:421: Using AiterCustomAllreduce for ROCm.
[36m(eager_allreduce pid=633)[0m [aiter] import [module_aiter_enum] under /sgl-workspace/aiter/aiter/jit/module_aiter_enum.so
[36m(eager_allreduce pid=633)[0m [2025-12-12 16:04:18] INFO core.py:477: import [module_aiter_enum] under /sgl-workspace/aiter/aiter/jit/module_aiter_enum.so
[36m(eager_allreduce pid=633)[0m [aiter] import [module_custom_all_reduce] under /sgl-workspace/aiter/aiter/jit/module_custom_all_reduce.so
[36m(eager_allreduce pid=633)[0m [2025-12-12 16:04:37] INFO core.py:477: import [module_custom_all_reduce] under /sgl-workspace/aiter/aiter/jit/module_custom_all_reduce.so
[36m(eager_allreduce pid=633)[0m [2025-12-12 16:04:37] INFO custom_all_reduce.py:421: Using AiterCustomAllreduce for ROCm.
/usr/lib/python3.10/subprocess.py:1072: ResourceWarning: subprocess 410 is still running
  _warn("subprocess %s is still running" % self.pid,
ResourceWarning: Enable tracemalloc to get the object allocation traceback
/opt/venv/lib/python3.10/site-packages/ray/_private/node.py:1204: ResourceWarning: unclosed file <_io.TextIOWrapper name='/dev/null' mode='w' encoding='UTF-8'>
  process_info = ray._private.services.start_gcs_server(
ResourceWarning: Enable tracemalloc to get the object allocation traceback
/opt/venv/lib/python3.10/site-packages/ray/_private/node.py:1414: ResourceWarning: unclosed file <_io.TextIOWrapper name='/tmp/ray/session_2025-12-12_16-04-40_384077_13/logs/monitor.out' mode='a' encoding='utf-8'>
  self.start_monitor()
ResourceWarning: Enable tracemalloc to get the object allocation traceback
/opt/venv/lib/python3.10/site-packages/ray/_private/node.py:1414: ResourceWarning: unclosed file <_io.TextIOWrapper name='/tmp/ray/session_2025-12-12_16-04-40_384077_13/logs/monitor.err' mode='a' encoding='utf-8'>
  self.start_monitor()
ResourceWarning: Enable tracemalloc to get the object allocation traceback
/opt/venv/lib/python3.10/site-packages/ray/_private/node.py:1425: ResourceWarning: unclosed file <_io.TextIOWrapper name='/tmp/ray/session_2025-12-12_16-04-40_384077_13/logs/dashboard.err' mode='a' encoding='utf-8'>
  self.start_api_server(
ResourceWarning: Enable tracemalloc to get the object allocation traceback
/opt/venv/lib/python3.10/site-packages/ray/_private/node.py:1469: ResourceWarning: unclosed file <_io.TextIOWrapper name='/tmp/ray/session_2025-12-12_16-04-40_384077_13/logs/log_monitor.err' mode='a' encoding='utf-8'>
  self.start_log_monitor()
ResourceWarning: Enable tracemalloc to get the object allocation traceback
2025-12-12 16:04:41,127	INFO worker.py:1852 -- Started a local Ray instance.
[36m(eager_allreduce pid=16174)[0m [2025-12-12 16:04:49] INFO pynccl.py:83: sglang is using nccl==2.26.6
[36m(eager_allreduce pid=16181)[0m [aiter] import [module_aiter_enum] under /sgl-workspace/aiter/aiter/jit/module_aiter_enum.so
[36m(eager_allreduce pid=16181)[0m [2025-12-12 16:04:53] INFO core.py:477: import [module_aiter_enum] under /sgl-workspace/aiter/aiter/jit/module_aiter_enum.so
[36m(eager_allreduce pid=16181)[0m [aiter] import [module_custom_all_reduce] under /sgl-workspace/aiter/aiter/jit/module_custom_all_reduce.so
[36m(eager_allreduce pid=16181)[0m [2025-12-12 16:04:53] INFO core.py:477: import [module_custom_all_reduce] under /sgl-workspace/aiter/aiter/jit/module_custom_all_reduce.so
[36m(eager_allreduce pid=16181)[0m [2025-12-12 16:04:53] INFO custom_all_reduce.py:421: Using AiterCustomAllreduce for ROCm.
[36m(eager_allreduce pid=16183)[0m [aiter] import [module_aiter_enum] under /sgl-workspace/aiter/aiter/jit/module_aiter_enum.so[32m [repeated 3x across cluster][0m
[36m(eager_allreduce pid=16183)[0m [2025-12-12 16:04:53] INFO core.py:477: import [module_aiter_enum] under /sgl-workspace/aiter/aiter/jit/module_aiter_enum.so[32m [repeated 3x across cluster][0m
[36m(eager_allreduce pid=16183)[0m [aiter] import [module_custom_all_reduce] under /sgl-workspace/aiter/aiter/jit/module_custom_all_reduce.so[32m [repeated 3x across cluster][0m
[36m(eager_allreduce pid=16183)[0m [2025-12-12 16:04:53] INFO core.py:477: import [module_custom_all_reduce] under /sgl-workspace/aiter/aiter/jit/module_custom_all_reduce.so[32m [repeated 3x across cluster][0m
[36m(eager_allreduce pid=16183)[0m [2025-12-12 16:04:53] INFO custom_all_reduce.py:421: Using AiterCustomAllreduce for ROCm.[32m [repeated 3x across cluster][0m
/usr/lib/python3.10/subprocess.py:1072: ResourceWarning: subprocess 15954 is still running
  _warn("subprocess %s is still running" % self.pid,
ResourceWarning: Enable tracemalloc to get the object allocation traceback
/opt/venv/lib/python3.10/site-packages/ray/_private/node.py:1414: ResourceWarning: unclosed file <_io.TextIOWrapper name='/tmp/ray/session_2025-12-12_16-04-56_260392_13/logs/monitor.out' mode='a' encoding='utf-8'>
  self.start_monitor()
ResourceWarning: Enable tracemalloc to get the object allocation traceback
/opt/venv/lib/python3.10/site-packages/ray/_private/node.py:1414: ResourceWarning: unclosed file <_io.TextIOWrapper name='/tmp/ray/session_2025-12-12_16-04-56_260392_13/logs/monitor.err' mode='a' encoding='utf-8'>
  self.start_monitor()
ResourceWarning: Enable tracemalloc to get the object allocation traceback
/opt/venv/lib/python3.10/site-packages/ray/_private/node.py:1425: ResourceWarning: unclosed file <_io.TextIOWrapper name='/tmp/ray/session_2025-12-12_16-04-56_260392_13/logs/dashboard.err' mode='a' encoding='utf-8'>
  self.start_api_server(
ResourceWarning: Enable tracemalloc to get the object allocation traceback
/opt/venv/lib/python3.10/site-packages/ray/_private/node.py:1469: ResourceWarning: unclosed file <_io.TextIOWrapper name='/tmp/ray/session_2025-12-12_16-04-56_260392_13/logs/log_monitor.err' mode='a' encoding='utf-8'>
  self.start_log_monitor()
ResourceWarning: Enable tracemalloc to get the object allocation traceback
2025-12-12 16:04:57,107	INFO worker.py:1852 -- Started a local Ray instance.
[36m(eager_allreduce pid=31575)[0m [2025-12-12 16:05:05] INFO pynccl.py:83: sglang is using nccl==2.26.6
[36m(eager_allreduce pid=31582)[0m [aiter] import [module_aiter_enum] under /sgl-workspace/aiter/aiter/jit/module_aiter_enum.so
[36m(eager_allreduce pid=31582)[0m [2025-12-12 16:05:09] INFO core.py:477: import [module_aiter_enum] under /sgl-workspace/aiter/aiter/jit/module_aiter_enum.so
[36m(eager_allreduce pid=31582)[0m [aiter] import [module_custom_all_reduce] under /sgl-workspace/aiter/aiter/jit/module_custom_all_reduce.so
[36m(eager_allreduce pid=31582)[0m [2025-12-12 16:05:09] INFO core.py:477: import [module_custom_all_reduce] under /sgl-workspace/aiter/aiter/jit/module_custom_all_reduce.so
[36m(eager_allreduce pid=31582)[0m [2025-12-12 16:05:09] INFO custom_all_reduce.py:421: Using AiterCustomAllreduce for ROCm.
[36m(eager_allreduce pid=31582)[0m [2025-12-12 16:05:09] WARNING quick_all_reduce.py:126: Custom quick allreduce is disabled due to an unsupported world size: 6. Supported world sizes: [2, 4, 8].
[36m(eager_allreduce pid=31569)[0m [aiter] import [module_aiter_enum] under /sgl-workspace/aiter/aiter/jit/module_aiter_enum.so[32m [repeated 5x across cluster][0m
[36m(eager_allreduce pid=31569)[0m [2025-12-12 16:05:09] INFO core.py:477: import [module_aiter_enum] under /sgl-workspace/aiter/aiter/jit/module_aiter_enum.so[32m [repeated 5x across cluster][0m
[36m(eager_allreduce pid=31585)[0m [aiter] import [module_custom_all_reduce] under /sgl-workspace/aiter/aiter/jit/module_custom_all_reduce.so[32m [repeated 5x across cluster][0m
[36m(eager_allreduce pid=31585)[0m [2025-12-12 16:05:09] INFO core.py:477: import [module_custom_all_reduce] under /sgl-workspace/aiter/aiter/jit/module_custom_all_reduce.so[32m [repeated 5x across cluster][0m
[36m(eager_allreduce pid=31585)[0m [2025-12-12 16:05:09] INFO custom_all_reduce.py:421: Using AiterCustomAllreduce for ROCm.[32m [repeated 5x across cluster][0m
[36m(eager_allreduce pid=31586)[0m [2025-12-12 16:05:09] WARNING quick_all_reduce.py:126: Custom quick allreduce is disabled due to an unsupported world size: 6. Supported world sizes: [2, 4, 8].[32m [repeated 5x across cluster][0m
/usr/lib/python3.10/subprocess.py:1072: ResourceWarning: subprocess 31349 is still running
  _warn("subprocess %s is still running" % self.pid,
ResourceWarning: Enable tracemalloc to get the object allocation traceback
/opt/venv/lib/python3.10/site-packages/ray/_private/node.py:1414: ResourceWarning: unclosed file <_io.TextIOWrapper name='/tmp/ray/session_2025-12-12_16-05-13_238718_13/logs/monitor.out' mode='a' encoding='utf-8'>
  self.start_monitor()
ResourceWarning: Enable tracemalloc to get the object allocation traceback
/opt/venv/lib/python3.10/site-packages/ray/_private/node.py:1414: ResourceWarning: unclosed file <_io.TextIOWrapper name='/tmp/ray/session_2025-12-12_16-05-13_238718_13/logs/monitor.err' mode='a' encoding='utf-8'>
  self.start_monitor()
ResourceWarning: Enable tracemalloc to get the object allocation traceback
/opt/venv/lib/python3.10/site-packages/ray/_private/node.py:1425: ResourceWarning: unclosed file <_io.TextIOWrapper name='/tmp/ray/session_2025-12-12_16-05-13_238718_13/logs/dashboard.err' mode='a' encoding='utf-8'>
  self.start_api_server(
ResourceWarning: Enable tracemalloc to get the object allocation traceback
/opt/venv/lib/python3.10/site-packages/ray/_private/node.py:1469: ResourceWarning: unclosed file <_io.TextIOWrapper name='/tmp/ray/session_2025-12-12_16-05-13_238718_13/logs/log_monitor.err' mode='a' encoding='utf-8'>
  self.start_log_monitor()
ResourceWarning: Enable tracemalloc to get the object allocation traceback
2025-12-12 16:05:14,099	INFO worker.py:1852 -- Started a local Ray instance.
[36m(eager_allreduce pid=47191)[0m [2025-12-12 16:05:22] INFO pynccl.py:83: sglang is using nccl==2.26.6
[36m(eager_allreduce pid=47183)[0m [aiter] import [module_aiter_enum] under /sgl-workspace/aiter/aiter/jit/module_aiter_enum.so
[36m(eager_allreduce pid=47183)[0m [2025-12-12 16:05:29] INFO core.py:477: import [module_aiter_enum] under /sgl-workspace/aiter/aiter/jit/module_aiter_enum.so
[36m(eager_allreduce pid=47183)[0m [aiter] import [module_custom_all_reduce] under /sgl-workspace/aiter/aiter/jit/module_custom_all_reduce.so
[36m(eager_allreduce pid=47183)[0m [2025-12-12 16:05:29] INFO core.py:477: import [module_custom_all_reduce] under /sgl-workspace/aiter/aiter/jit/module_custom_all_reduce.so
[36m(eager_allreduce pid=47183)[0m [2025-12-12 16:05:29] INFO custom_all_reduce.py:421: Using AiterCustomAllreduce for ROCm.
[36m(eager_allreduce pid=47186)[0m [aiter] import [module_aiter_enum] under /sgl-workspace/aiter/aiter/jit/module_aiter_enum.so[32m [repeated 7x across cluster][0m
[36m(eager_allreduce pid=47186)[0m [2025-12-12 16:05:29] INFO core.py:477: import [module_aiter_enum] under /sgl-workspace/aiter/aiter/jit/module_aiter_enum.so[32m [repeated 7x across cluster][0m
[36m(eager_allreduce pid=47186)[0m [aiter] import [module_custom_all_reduce] under /sgl-workspace/aiter/aiter/jit/module_custom_all_reduce.so[32m [repeated 7x across cluster][0m
[36m(eager_allreduce pid=47186)[0m [2025-12-12 16:05:29] INFO core.py:477: import [module_custom_all_reduce] under /sgl-workspace/aiter/aiter/jit/module_custom_all_reduce.so[32m [repeated 7x across cluster][0m
[36m(eager_allreduce pid=47186)[0m [2025-12-12 16:05:29] INFO custom_all_reduce.py:421: Using AiterCustomAllreduce for ROCm.[32m [repeated 7x across cluster][0m
/usr/lib/python3.10/subprocess.py:1072: ResourceWarning: subprocess 46956 is still running
  _warn("subprocess %s is still running" % self.pid,
ResourceWarning: Enable tracemalloc to get the object allocation traceback
./opt/venv/lib/python3.10/site-packages/ray/_private/node.py:1414: ResourceWarning: unclosed file <_io.TextIOWrapper name='/tmp/ray/session_2025-12-12_16-05-34_990571_13/logs/monitor.out' mode='a' encoding='utf-8'>
  self.start_monitor()
ResourceWarning: Enable tracemalloc to get the object allocation traceback
/opt/venv/lib/python3.10/site-packages/ray/_private/node.py:1414: ResourceWarning: unclosed file <_io.TextIOWrapper name='/tmp/ray/session_2025-12-12_16-05-34_990571_13/logs/monitor.err' mode='a' encoding='utf-8'>
  self.start_monitor()
ResourceWarning: Enable tracemalloc to get the object allocation traceback
/opt/venv/lib/python3.10/site-packages/ray/_private/node.py:1425: ResourceWarning: unclosed file <_io.TextIOWrapper name='/tmp/ray/session_2025-12-12_16-05-34_990571_13/logs/dashboard.err' mode='a' encoding='utf-8'>
  self.start_api_server(
ResourceWarning: Enable tracemalloc to get the object allocation traceback
/opt/venv/lib/python3.10/site-packages/ray/_private/node.py:1469: ResourceWarning: unclosed file <_io.TextIOWrapper name='/tmp/ray/session_2025-12-12_16-05-34_990571_13/logs/log_monitor.err' mode='a' encoding='utf-8'>
  self.start_log_monitor()
ResourceWarning: Enable tracemalloc to get the object allocation traceback
2025-12-12 16:05:36,855	INFO worker.py:1852 -- Started a local Ray instance.
[36m(graph_allreduce pid=63069)[0m [2025-12-12 16:05:45] INFO pynccl.py:83: sglang is using nccl==2.26.6
[36m(graph_allreduce pid=63069)[0m [aiter] import [module_aiter_enum] under /sgl-workspace/aiter/aiter/jit/module_aiter_enum.so
[36m(graph_allreduce pid=63069)[0m [2025-12-12 16:05:48] INFO core.py:477: import [module_aiter_enum] under /sgl-workspace/aiter/aiter/jit/module_aiter_enum.so
[36m(graph_allreduce pid=63069)[0m [aiter] import [module_custom_all_reduce] under /sgl-workspace/aiter/aiter/jit/module_custom_all_reduce.so
[36m(graph_allreduce pid=63069)[0m [2025-12-12 16:05:48] INFO core.py:477: import [module_custom_all_reduce] under /sgl-workspace/aiter/aiter/jit/module_custom_all_reduce.so
[36m(graph_allreduce pid=63069)[0m [2025-12-12 16:05:48] INFO custom_all_reduce.py:421: Using AiterCustomAllreduce for ROCm.
[36m(graph_allreduce pid=63069)[0m [aiter] Registering 2 cuda graph addresses
[36m(graph_allreduce pid=63069)[0m [2025-12-12 16:05:49] INFO custom_all_reduce.py:246: Registering 2 cuda graph addresses
[36m(graph_allreduce pid=63073)[0m [aiter] import [module_aiter_enum] under /sgl-workspace/aiter/aiter/jit/module_aiter_enum.so
[36m(graph_allreduce pid=63073)[0m [2025-12-12 16:05:48] INFO core.py:477: import [module_aiter_enum] under /sgl-workspace/aiter/aiter/jit/module_aiter_enum.so
[36m(graph_allreduce pid=63073)[0m [aiter] import [module_custom_all_reduce] under /sgl-workspace/aiter/aiter/jit/module_custom_all_reduce.so
[36m(graph_allreduce pid=63073)[0m [2025-12-12 16:05:49] INFO core.py:477: import [module_custom_all_reduce] under /sgl-workspace/aiter/aiter/jit/module_custom_all_reduce.so
[36m(graph_allreduce pid=63073)[0m [2025-12-12 16:05:49] INFO custom_all_reduce.py:421: Using AiterCustomAllreduce for ROCm.
[36m(graph_allreduce pid=63073)[0m [aiter] Registering 0 cuda graph addresses[32m [repeated 479x across cluster][0m
[36m(graph_allreduce pid=63073)[0m [2025-12-12 16:05:52] INFO custom_all_reduce.py:246: Registering 0 cuda graph addresses[32m [repeated 479x across cluster][0m
/usr/lib/python3.10/subprocess.py:1072: ResourceWarning: subprocess 62818 is still running
  _warn("subprocess %s is still running" % self.pid,
ResourceWarning: Enable tracemalloc to get the object allocation traceback
/opt/venv/lib/python3.10/site-packages/ray/_private/node.py:1414: ResourceWarning: unclosed file <_io.TextIOWrapper name='/tmp/ray/session_2025-12-12_16-05-54_192580_13/logs/monitor.out' mode='a' encoding='utf-8'>
  self.start_monitor()
ResourceWarning: Enable tracemalloc to get the object allocation traceback
/opt/venv/lib/python3.10/site-packages/ray/_private/node.py:1414: ResourceWarning: unclosed file <_io.TextIOWrapper name='/tmp/ray/session_2025-12-12_16-05-54_192580_13/logs/monitor.err' mode='a' encoding='utf-8'>
  self.start_monitor()
ResourceWarning: Enable tracemalloc to get the object allocation traceback
/opt/venv/lib/python3.10/site-packages/ray/_private/node.py:1425: ResourceWarning: unclosed file <_io.TextIOWrapper name='/tmp/ray/session_2025-12-12_16-05-54_192580_13/logs/dashboard.err' mode='a' encoding='utf-8'>
  self.start_api_server(
ResourceWarning: Enable tracemalloc to get the object allocation traceback
/opt/venv/lib/python3.10/site-packages/ray/_private/node.py:1469: ResourceWarning: unclosed file <_io.TextIOWrapper name='/tmp/ray/session_2025-12-12_16-05-54_192580_13/logs/log_monitor.err' mode='a' encoding='utf-8'>
  self.start_log_monitor()
ResourceWarning: Enable tracemalloc to get the object allocation traceback
2025-12-12 16:05:55,075	INFO worker.py:1852 -- Started a local Ray instance.
[36m(graph_allreduce pid=78217)[0m [2025-12-12 16:06:03] INFO pynccl.py:83: sglang is using nccl==2.26.6
[36m(graph_allreduce pid=78200)[0m [aiter] import [module_aiter_enum] under /sgl-workspace/aiter/aiter/jit/module_aiter_enum.so
[36m(graph_allreduce pid=78200)[0m [2025-12-12 16:06:07] INFO core.py:477: import [module_aiter_enum] under /sgl-workspace/aiter/aiter/jit/module_aiter_enum.so
[36m(graph_allreduce pid=78194)[0m [aiter] import [module_custom_all_reduce] under /sgl-workspace/aiter/aiter/jit/module_custom_all_reduce.so
[36m(graph_allreduce pid=78194)[0m [2025-12-12 16:06:07] INFO core.py:477: import [module_custom_all_reduce] under /sgl-workspace/aiter/aiter/jit/module_custom_all_reduce.so
[36m(graph_allreduce pid=78194)[0m [2025-12-12 16:06:07] INFO custom_all_reduce.py:421: Using AiterCustomAllreduce for ROCm.
[36m(graph_allreduce pid=78200)[0m [aiter] Registering 2 cuda graph addresses
[36m(graph_allreduce pid=78200)[0m [2025-12-12 16:06:07] INFO custom_all_reduce.py:246: Registering 2 cuda graph addresses
[36m(graph_allreduce pid=78217)[0m [aiter] import [module_aiter_enum] under /sgl-workspace/aiter/aiter/jit/module_aiter_enum.so[32m [repeated 3x across cluster][0m
[36m(graph_allreduce pid=78217)[0m [2025-12-12 16:06:07] INFO core.py:477: import [module_aiter_enum] under /sgl-workspace/aiter/aiter/jit/module_aiter_enum.so[32m [repeated 3x across cluster][0m
[36m(graph_allreduce pid=78217)[0m [aiter] import [module_custom_all_reduce] under /sgl-workspace/aiter/aiter/jit/module_custom_all_reduce.so[32m [repeated 3x across cluster][0m
[36m(graph_allreduce pid=78217)[0m [2025-12-12 16:06:07] INFO core.py:477: import [module_custom_all_reduce] under /sgl-workspace/aiter/aiter/jit/module_custom_all_reduce.so[32m [repeated 3x across cluster][0m
[36m(graph_allreduce pid=78217)[0m [2025-12-12 16:06:07] INFO custom_all_reduce.py:421: Using AiterCustomAllreduce for ROCm.[32m [repeated 3x across cluster][0m
[36m(graph_allreduce pid=78217)[0m [aiter] Registering 0 cuda graph addresses[32m [repeated 959x across cluster][0m
[36m(graph_allreduce pid=78217)[0m [2025-12-12 16:06:11] INFO custom_all_reduce.py:246: Registering 0 cuda graph addresses[32m [repeated 959x across cluster][0m
/usr/lib/python3.10/subprocess.py:1072: ResourceWarning: subprocess 77974 is still running
  _warn("subprocess %s is still running" % self.pid,
ResourceWarning: Enable tracemalloc to get the object allocation traceback
/opt/venv/lib/python3.10/site-packages/ray/_private/node.py:1414: ResourceWarning: unclosed file <_io.TextIOWrapper name='/tmp/ray/session_2025-12-12_16-06-12_667401_13/logs/monitor.out' mode='a' encoding='utf-8'>
  self.start_monitor()
ResourceWarning: Enable tracemalloc to get the object allocation traceback
/opt/venv/lib/python3.10/site-packages/ray/_private/node.py:1414: ResourceWarning: unclosed file <_io.TextIOWrapper name='/tmp/ray/session_2025-12-12_16-06-12_667401_13/logs/monitor.err' mode='a' encoding='utf-8'>
  self.start_monitor()
ResourceWarning: Enable tracemalloc to get the object allocation traceback
/opt/venv/lib/python3.10/site-packages/ray/_private/node.py:1425: ResourceWarning: unclosed file <_io.TextIOWrapper name='/tmp/ray/session_2025-12-12_16-06-12_667401_13/logs/dashboard.err' mode='a' encoding='utf-8'>
  self.start_api_server(
ResourceWarning: Enable tracemalloc to get the object allocation traceback
/opt/venv/lib/python3.10/site-packages/ray/_private/node.py:1469: ResourceWarning: unclosed file <_io.TextIOWrapper name='/tmp/ray/session_2025-12-12_16-06-12_667401_13/logs/log_monitor.err' mode='a' encoding='utf-8'>
  self.start_log_monitor()
ResourceWarning: Enable tracemalloc to get the object allocation traceback
2025-12-12 16:06:13,583	INFO worker.py:1852 -- Started a local Ray instance.
[36m(graph_allreduce pid=93586)[0m [2025-12-12 16:06:21] INFO pynccl.py:83: sglang is using nccl==2.26.6
[36m(graph_allreduce pid=93586)[0m [aiter] import [module_aiter_enum] under /sgl-workspace/aiter/aiter/jit/module_aiter_enum.so
[36m(graph_allreduce pid=93586)[0m [2025-12-12 16:06:26] INFO core.py:477: import [module_aiter_enum] under /sgl-workspace/aiter/aiter/jit/module_aiter_enum.so
[36m(graph_allreduce pid=93586)[0m [aiter] import [module_custom_all_reduce] under /sgl-workspace/aiter/aiter/jit/module_custom_all_reduce.so
[36m(graph_allreduce pid=93586)[0m [2025-12-12 16:06:26] INFO core.py:477: import [module_custom_all_reduce] under /sgl-workspace/aiter/aiter/jit/module_custom_all_reduce.so
[36m(graph_allreduce pid=93586)[0m [2025-12-12 16:06:26] INFO custom_all_reduce.py:421: Using AiterCustomAllreduce for ROCm.
[36m(graph_allreduce pid=93583)[0m [2025-12-12 16:06:26] WARNING quick_all_reduce.py:126: Custom quick allreduce is disabled due to an unsupported world size: 6. Supported world sizes: [2, 4, 8].
[36m(graph_allreduce pid=93583)[0m [aiter] Registering 2 cuda graph addresses
[36m(graph_allreduce pid=93583)[0m [2025-12-12 16:06:27] INFO custom_all_reduce.py:246: Registering 2 cuda graph addresses
[36m(graph_allreduce pid=93581)[0m [aiter] import [module_aiter_enum] under /sgl-workspace/aiter/aiter/jit/module_aiter_enum.so[32m [repeated 5x across cluster][0m
[36m(graph_allreduce pid=93581)[0m [2025-12-12 16:06:26] INFO core.py:477: import [module_aiter_enum] under /sgl-workspace/aiter/aiter/jit/module_aiter_enum.so[32m [repeated 5x across cluster][0m
[36m(graph_allreduce pid=93581)[0m [aiter] import [module_custom_all_reduce] under /sgl-workspace/aiter/aiter/jit/module_custom_all_reduce.so[32m [repeated 5x across cluster][0m
[36m(graph_allreduce pid=93581)[0m [2025-12-12 16:06:26] INFO core.py:477: import [module_custom_all_reduce] under /sgl-workspace/aiter/aiter/jit/module_custom_all_reduce.so[32m [repeated 5x across cluster][0m
[36m(graph_allreduce pid=93581)[0m [2025-12-12 16:06:26] INFO custom_all_reduce.py:421: Using AiterCustomAllreduce for ROCm.[32m [repeated 5x across cluster][0m
[36m(graph_allreduce pid=93581)[0m [2025-12-12 16:06:26] WARNING quick_all_reduce.py:126: Custom quick allreduce is disabled due to an unsupported world size: 6. Supported world sizes: [2, 4, 8].[32m [repeated 5x across cluster][0m
[36m(graph_allreduce pid=93583)[0m [aiter] Registering 2 cuda graph addresses[32m [repeated 1151x across cluster][0m
[36m(graph_allreduce pid=93583)[0m [2025-12-12 16:06:32] INFO custom_all_reduce.py:246: Registering 2 cuda graph addresses[32m [repeated 1151x across cluster][0m
[36m(graph_allreduce pid=93581)[0m [aiter] Registering 0 cuda graph addresses[32m [repeated 288x across cluster][0m
[36m(graph_allreduce pid=93581)[0m [2025-12-12 16:06:34] INFO custom_all_reduce.py:246: Registering 0 cuda graph addresses[32m [repeated 288x across cluster][0m
/usr/lib/python3.10/subprocess.py:1072: ResourceWarning: subprocess 93357 is still running
  _warn("subprocess %s is still running" % self.pid,
ResourceWarning: Enable tracemalloc to get the object allocation traceback
/opt/venv/lib/python3.10/site-packages/ray/_private/node.py:1414: ResourceWarning: unclosed file <_io.TextIOWrapper name='/tmp/ray/session_2025-12-12_16-06-36_144057_13/logs/monitor.out' mode='a' encoding='utf-8'>
  self.start_monitor()
ResourceWarning: Enable tracemalloc to get the object allocation traceback
/opt/venv/lib/python3.10/site-packages/ray/_private/node.py:1414: ResourceWarning: unclosed file <_io.TextIOWrapper name='/tmp/ray/session_2025-12-12_16-06-36_144057_13/logs/monitor.err' mode='a' encoding='utf-8'>
  self.start_monitor()
ResourceWarning: Enable tracemalloc to get the object allocation traceback
/opt/venv/lib/python3.10/site-packages/ray/_private/node.py:1425: ResourceWarning: unclosed file <_io.TextIOWrapper name='/tmp/ray/session_2025-12-12_16-06-36_144057_13/logs/dashboard.err' mode='a' encoding='utf-8'>
  self.start_api_server(
ResourceWarning: Enable tracemalloc to get the object allocation traceback
/opt/venv/lib/python3.10/site-packages/ray/_private/node.py:1469: ResourceWarning: unclosed file <_io.TextIOWrapper name='/tmp/ray/session_2025-12-12_16-06-36_144057_13/logs/log_monitor.err' mode='a' encoding='utf-8'>
  self.start_log_monitor()
ResourceWarning: Enable tracemalloc to get the object allocation traceback
2025-12-12 16:06:37,991	INFO worker.py:1852 -- Started a local Ray instance.
[36m(graph_allreduce pid=109236)[0m [2025-12-12 16:06:46] INFO pynccl.py:83: sglang is using nccl==2.26.6
[36m(graph_allreduce pid=109224)[0m [aiter] import [module_aiter_enum] under /sgl-workspace/aiter/aiter/jit/module_aiter_enum.so
[36m(graph_allreduce pid=109224)[0m [2025-12-12 16:06:53] INFO core.py:477: import [module_aiter_enum] under /sgl-workspace/aiter/aiter/jit/module_aiter_enum.so
[36m(graph_allreduce pid=109224)[0m [aiter] import [module_custom_all_reduce] under /sgl-workspace/aiter/aiter/jit/module_custom_all_reduce.so
[36m(graph_allreduce pid=109224)[0m [2025-12-12 16:06:53] INFO core.py:477: import [module_custom_all_reduce] under /sgl-workspace/aiter/aiter/jit/module_custom_all_reduce.so
[36m(graph_allreduce pid=109224)[0m [2025-12-12 16:06:53] INFO custom_all_reduce.py:421: Using AiterCustomAllreduce for ROCm.
[36m(graph_allreduce pid=109233)[0m [aiter] Registering 2 cuda graph addresses
[36m(graph_allreduce pid=109233)[0m [2025-12-12 16:06:57] INFO custom_all_reduce.py:246: Registering 2 cuda graph addresses
[36m(graph_allreduce pid=109236)[0m [aiter] import [module_aiter_enum] under /sgl-workspace/aiter/aiter/jit/module_aiter_enum.so[32m [repeated 7x across cluster][0m
[36m(graph_allreduce pid=109236)[0m [2025-12-12 16:06:54] INFO core.py:477: import [module_aiter_enum] under /sgl-workspace/aiter/aiter/jit/module_aiter_enum.so[32m [repeated 7x across cluster][0m
[36m(graph_allreduce pid=109236)[0m [aiter] import [module_custom_all_reduce] under /sgl-workspace/aiter/aiter/jit/module_custom_all_reduce.so[32m [repeated 7x across cluster][0m
[36m(graph_allreduce pid=109236)[0m [2025-12-12 16:06:54] INFO core.py:477: import [module_custom_all_reduce] under /sgl-workspace/aiter/aiter/jit/module_custom_all_reduce.so[32m [repeated 7x across cluster][0m
[36m(graph_allreduce pid=109236)[0m [2025-12-12 16:06:54] INFO custom_all_reduce.py:421: Using AiterCustomAllreduce for ROCm.[32m [repeated 7x across cluster][0m
[36m(graph_allreduce pid=109233)[0m [aiter] Registering 0 cuda graph addresses[32m [repeated 1488x across cluster][0m
[36m(graph_allreduce pid=109233)[0m [2025-12-12 16:07:02] INFO custom_all_reduce.py:246: Registering 0 cuda graph addresses[32m [repeated 1488x across cluster][0m
[36m(graph_allreduce pid=109233)[0m [aiter] Registering 0 cuda graph addresses[32m [repeated 273x across cluster][0m
[36m(graph_allreduce pid=109233)[0m [2025-12-12 16:07:07] INFO custom_all_reduce.py:246: Registering 0 cuda graph addresses[32m [repeated 273x across cluster][0m
[36m(graph_allreduce pid=109238)[0m [aiter] Registering 0 cuda graph addresses[32m [repeated 150x across cluster][0m
[36m(graph_allreduce pid=109238)[0m [2025-12-12 16:07:08] INFO custom_all_reduce.py:246: Registering 0 cuda graph addresses[32m [repeated 150x across cluster][0m
/usr/lib/python3.10/subprocess.py:1072: ResourceWarning: subprocess 108977 is still running
  _warn("subprocess %s is still running" % self.pid,
ResourceWarning: Enable tracemalloc to get the object allocation traceback
.
----------------------------------------------------------------------
Ran 2 tests in 194.916s

OK
[CI Test Method] TestCustomAllReduce.test_eager_allreduce
[36m(eager_allreduce pid=648)[0m [Gloo] Rank 0 is connected to 1 peer ranks. Expected number of connected peer ranks is : 1
[36m(eager_allreduce pid=648)[0m [Gloo] Rank 0 is connected to 0 peer ranks. Expected number of connected peer ranks is : 0[32m [repeated 5x across cluster] (Ray deduplicates logs by default. Set RAY_DEDUP_LOGS=0 to disable log deduplication, or see https://docs.ray.io/en/master/ray-observability/user-guides/configure-logging.html#log-deduplication for more options.)[0m
[36m(eager_allreduce pid=633)[0m [Gloo] Rank 0 is connected to 0 peer ranks. Expected number of connected peer ranks is : 0[32m [repeated 2x across cluster][0m
[36m(eager_allreduce pid=16174)[0m [Gloo] Rank 0 is connected to 3 peer ranks. Expected number of connected peer ranks is : 3
[36m(eager_allreduce pid=16174)[0m [Gloo] Rank 0 is connected to 0 peer ranks. Expected number of connected peer ranks is : 0[32m [repeated 9x across cluster][0m
[36m(eager_allreduce pid=16181)[0m [Gloo] Rank 0 is connected to 0 peer ranks. Expected number of connected peer ranks is : 0[32m [repeated 6x across cluster][0m
[36m(eager_allreduce pid=31569)[0m [Gloo] Rank 3 is connected to 5 peer ranks. Expected number of connected peer ranks is : 5
[36m(eager_allreduce pid=31569)[0m [Gloo] Rank 0 is connected to 0 peer ranks. Expected number of connected peer ranks is : 0[32m [repeated 13x across cluster][0m
[36m(eager_allreduce pid=31586)[0m [Gloo] Rank 0 is connected to 0 peer ranks. Expected number of connected peer ranks is : 0[32m [repeated 10x across cluster][0m
[36m(eager_allreduce pid=47191)[0m [Gloo] Rank 0 is connected to 7 peer ranks. Expected number of connected peer ranks is : 7
[36m(eager_allreduce pid=47191)[0m [Gloo] Rank 0 is connected to 0 peer ranks. Expected number of connected peer ranks is : 0[32m [repeated 17x across cluster][0m
[36m(eager_allreduce pid=47197)[0m [Gloo] Rank 0 is connected to 0 peer ranks. Expected number of connected peer ranks is : 0[32m [repeated 14x across cluster][0m
[CI Test Method] TestCustomAllReduce.test_graph_allreduce
[36m(graph_allreduce pid=63069)[0m [Gloo] Rank 0 is connected to 1 peer ranks. Expected number of connected peer ranks is : 1
[36m(graph_allreduce pid=63073)[0m [Gloo] Rank 0 is connected to 0 peer ranks. Expected number of connected peer ranks is : 0[32m [repeated 7x across cluster][0m
[36m(graph_allreduce pid=78197)[0m [Gloo] Rank 3 is connected to 3 peer ranks. Expected number of connected peer ranks is : 3
[36m(graph_allreduce pid=78197)[0m [Gloo] Rank 0 is connected to 0 peer ranks. Expected number of connected peer ranks is : 0[32m [repeated 9x across cluster][0m
[36m(graph_allreduce pid=78217)[0m [Gloo] Rank 0 is connected to 0 peer ranks. Expected number of connected peer ranks is : 0[32m [repeated 6x across cluster][0m
[36m(graph_allreduce pid=93594)[0m [Gloo] Rank 3 is connected to 5 peer ranks. Expected number of connected peer ranks is : 5
[36m(graph_allreduce pid=93577)[0m [Gloo] Rank 0 is connected to 0 peer ranks. Expected number of connected peer ranks is : 0[32m [repeated 13x across cluster][0m
[36m(graph_allreduce pid=93593)[0m [Gloo] Rank 0 is connected to 0 peer ranks. Expected number of connected peer ranks is : 0[32m [repeated 10x across cluster][0m
[36m(graph_allreduce pid=109233)[0m [Gloo] Rank 5 is connected to 7 peer ranks. Expected number of connected peer ranks is : 7
[36m(graph_allreduce pid=109236)[0m [Gloo] Rank 0 is connected to 0 peer ranks. Expected number of connected peer ranks is : 0[32m [repeated 17x across cluster][0m
[36m(graph_allreduce pid=109238)[0m [Gloo] Rank 0 is connected to 0 peer ranks. Expected number of connected peer ranks is : 0[32m [repeated 14x across cluster][0m
sys:1: DeprecationWarning: builtin type swigvarlink has no __module__ attribute

==========================================
End time: 2025-12-12 10:07:11 CST
Exit code: 0
Result: PASSED
==========================================
