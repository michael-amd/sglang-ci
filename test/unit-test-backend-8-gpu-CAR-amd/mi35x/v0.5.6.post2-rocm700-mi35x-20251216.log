==========================================
SGL Unit Test Log
==========================================
Test: test_custom_allreduce.TestCustomAllReduce
Image: rocm/sgl-dev:v0.5.6.post2-rocm700-mi35x-20251216
Container: sgl-dev_v0.5.6.post2-rocm700-mi35x-20251216
Hardware: mi35x
Machine: smci355-ccs-aus-m12-33
Start time: 2025-12-16 10:03:37 CST
Test directory: /sgl-workspace/sglang/test/manual
Command: CUDA_VISIBLE_DEVICES=0,1,2,3,4,5,6,7 python3 -m unittest test_custom_allreduce.TestCustomAllReduce
==========================================

/opt/venv/lib/python3.10/site-packages/ray/_private/node.py:1204: ResourceWarning: unclosed file <_io.TextIOWrapper name='/dev/null' mode='w' encoding='UTF-8'>
  process_info = ray._private.services.start_gcs_server(
ResourceWarning: Enable tracemalloc to get the object allocation traceback
/opt/venv/lib/python3.10/site-packages/ray/_private/node.py:1414: ResourceWarning: unclosed file <_io.TextIOWrapper name='/tmp/ray/session_2025-12-16_16-03-41_418654_13/logs/monitor.out' mode='a' encoding='utf-8'>
  self.start_monitor()
ResourceWarning: Enable tracemalloc to get the object allocation traceback
/opt/venv/lib/python3.10/site-packages/ray/_private/node.py:1414: ResourceWarning: unclosed file <_io.TextIOWrapper name='/tmp/ray/session_2025-12-16_16-03-41_418654_13/logs/monitor.err' mode='a' encoding='utf-8'>
  self.start_monitor()
ResourceWarning: Enable tracemalloc to get the object allocation traceback
/opt/venv/lib/python3.10/site-packages/ray/_private/node.py:1425: ResourceWarning: unclosed file <_io.TextIOWrapper name='/tmp/ray/session_2025-12-16_16-03-41_418654_13/logs/dashboard.err' mode='a' encoding='utf-8'>
  self.start_api_server(
ResourceWarning: Enable tracemalloc to get the object allocation traceback
/opt/venv/lib/python3.10/site-packages/ray/_private/utils.py:521: ResourceWarning: unclosed file <_io.TextIOWrapper name='/sys/fs/cgroup/cpu.max' mode='r' encoding='UTF-8'>
  max_file = open(cpu_max_file_name).read()
ResourceWarning: Enable tracemalloc to get the object allocation traceback
/opt/venv/lib/python3.10/site-packages/ray/_private/node.py:1247: ResourceWarning: unclosed file <_io.TextIOWrapper name='/dev/null' mode='w' encoding='UTF-8'>
  process_info = ray._private.services.start_raylet(
ResourceWarning: Enable tracemalloc to get the object allocation traceback
/opt/venv/lib/python3.10/site-packages/ray/_private/node.py:1469: ResourceWarning: unclosed file <_io.TextIOWrapper name='/tmp/ray/session_2025-12-16_16-03-41_418654_13/logs/log_monitor.err' mode='a' encoding='utf-8'>
  self.start_log_monitor()
ResourceWarning: Enable tracemalloc to get the object allocation traceback
2025-12-16 16:03:43,623	INFO worker.py:1852 -- Started a local Ray instance.
[36m(eager_allreduce pid=688)[0m [2025-12-16 16:03:50] INFO pynccl.py:83: sglang is using nccl==2.26.6
[36m(eager_allreduce pid=670)[0m [aiter] waiting for baton release at /sgl-workspace/aiter/aiter/jit/build/lock_module_aiter_enum
[36m(eager_allreduce pid=670)[0m [2025-12-16 16:03:57] INFO file_baton.py:48: waiting for baton release at /sgl-workspace/aiter/aiter/jit/build/lock_module_aiter_enum
[36m(eager_allreduce pid=688)[0m [aiter] start build [module_aiter_enum] under /sgl-workspace/aiter/aiter/jit/build/module_aiter_enum
[36m(eager_allreduce pid=688)[0m [2025-12-16 16:03:57] INFO core.py:524: start build [module_aiter_enum] under /sgl-workspace/aiter/aiter/jit/build/module_aiter_enum
[36m(eager_allreduce pid=670)[0m [aiter] import [module_aiter_enum] under /sgl-workspace/aiter/aiter/jit/module_aiter_enum.so
[36m(eager_allreduce pid=670)[0m [2025-12-16 16:04:04] INFO core.py:477: import [module_aiter_enum] under /sgl-workspace/aiter/aiter/jit/module_aiter_enum.so
[36m(eager_allreduce pid=688)[0m [aiter] [32mfinish build [module_aiter_enum], cost 7.4s [0m
[36m(eager_allreduce pid=688)[0m [2025-12-16 16:04:04] INFO core.py:673: [32mfinish build [module_aiter_enum], cost 7.4s [0m
[36m(eager_allreduce pid=670)[0m [aiter] waiting for baton release at /sgl-workspace/aiter/aiter/jit/build/lock_module_custom_all_reduce
[36m(eager_allreduce pid=670)[0m [2025-12-16 16:04:04] INFO file_baton.py:48: waiting for baton release at /sgl-workspace/aiter/aiter/jit/build/lock_module_custom_all_reduce
[36m(eager_allreduce pid=688)[0m [aiter] start build [module_custom_all_reduce] under /sgl-workspace/aiter/aiter/jit/build/module_custom_all_reduce
[36m(eager_allreduce pid=688)[0m [2025-12-16 16:04:04] INFO core.py:524: start build [module_custom_all_reduce] under /sgl-workspace/aiter/aiter/jit/build/module_custom_all_reduce
[36m(eager_allreduce pid=688)[0m [aiter] [32mfinish build [module_custom_all_reduce], cost 19.4s [0m
[36m(eager_allreduce pid=688)[0m [2025-12-16 16:04:24] INFO core.py:673: [32mfinish build [module_custom_all_reduce], cost 19.4s [0m
[36m(eager_allreduce pid=688)[0m [aiter] import [module_custom_all_reduce] under /sgl-workspace/aiter/aiter/jit/module_custom_all_reduce.so
[36m(eager_allreduce pid=688)[0m [2025-12-16 16:04:24] INFO core.py:477: import [module_custom_all_reduce] under /sgl-workspace/aiter/aiter/jit/module_custom_all_reduce.so
[36m(eager_allreduce pid=688)[0m [2025-12-16 16:04:24] INFO custom_all_reduce.py:421: Using AiterCustomAllreduce for ROCm.
[36m(eager_allreduce pid=688)[0m [aiter] import [module_aiter_enum] under /sgl-workspace/aiter/aiter/jit/module_aiter_enum.so
[36m(eager_allreduce pid=688)[0m [2025-12-16 16:04:04] INFO core.py:477: import [module_aiter_enum] under /sgl-workspace/aiter/aiter/jit/module_aiter_enum.so
[36m(eager_allreduce pid=670)[0m [aiter] import [module_custom_all_reduce] under /sgl-workspace/aiter/aiter/jit/module_custom_all_reduce.so
[36m(eager_allreduce pid=670)[0m [2025-12-16 16:04:24] INFO core.py:477: import [module_custom_all_reduce] under /sgl-workspace/aiter/aiter/jit/module_custom_all_reduce.so
[36m(eager_allreduce pid=670)[0m [2025-12-16 16:04:24] INFO custom_all_reduce.py:421: Using AiterCustomAllreduce for ROCm.
/usr/lib/python3.10/subprocess.py:1072: ResourceWarning: subprocess 416 is still running
  _warn("subprocess %s is still running" % self.pid,
ResourceWarning: Enable tracemalloc to get the object allocation traceback
/opt/venv/lib/python3.10/site-packages/ray/_private/node.py:1204: ResourceWarning: unclosed file <_io.TextIOWrapper name='/dev/null' mode='w' encoding='UTF-8'>
  process_info = ray._private.services.start_gcs_server(
ResourceWarning: Enable tracemalloc to get the object allocation traceback
/opt/venv/lib/python3.10/site-packages/ray/_private/node.py:1414: ResourceWarning: unclosed file <_io.TextIOWrapper name='/tmp/ray/session_2025-12-16_16-04-27_222948_13/logs/monitor.out' mode='a' encoding='utf-8'>
  self.start_monitor()
ResourceWarning: Enable tracemalloc to get the object allocation traceback
/opt/venv/lib/python3.10/site-packages/ray/_private/node.py:1414: ResourceWarning: unclosed file <_io.TextIOWrapper name='/tmp/ray/session_2025-12-16_16-04-27_222948_13/logs/monitor.err' mode='a' encoding='utf-8'>
  self.start_monitor()
ResourceWarning: Enable tracemalloc to get the object allocation traceback
/opt/venv/lib/python3.10/site-packages/ray/_private/node.py:1425: ResourceWarning: unclosed file <_io.TextIOWrapper name='/tmp/ray/session_2025-12-16_16-04-27_222948_13/logs/dashboard.err' mode='a' encoding='utf-8'>
  self.start_api_server(
ResourceWarning: Enable tracemalloc to get the object allocation traceback
/opt/venv/lib/python3.10/site-packages/ray/_private/node.py:1469: ResourceWarning: unclosed file <_io.TextIOWrapper name='/tmp/ray/session_2025-12-16_16-04-27_222948_13/logs/log_monitor.err' mode='a' encoding='utf-8'>
  self.start_log_monitor()
ResourceWarning: Enable tracemalloc to get the object allocation traceback
2025-12-16 16:04:28,130	INFO worker.py:1852 -- Started a local Ray instance.
[36m(eager_allreduce pid=16195)[0m [2025-12-16 16:04:36] INFO pynccl.py:83: sglang is using nccl==2.26.6
[36m(eager_allreduce pid=16195)[0m [aiter] import [module_aiter_enum] under /sgl-workspace/aiter/aiter/jit/module_aiter_enum.so
[36m(eager_allreduce pid=16195)[0m [2025-12-16 16:04:40] INFO core.py:477: import [module_aiter_enum] under /sgl-workspace/aiter/aiter/jit/module_aiter_enum.so
[36m(eager_allreduce pid=16195)[0m [aiter] import [module_custom_all_reduce] under /sgl-workspace/aiter/aiter/jit/module_custom_all_reduce.so
[36m(eager_allreduce pid=16195)[0m [2025-12-16 16:04:40] INFO core.py:477: import [module_custom_all_reduce] under /sgl-workspace/aiter/aiter/jit/module_custom_all_reduce.so
[36m(eager_allreduce pid=16195)[0m [2025-12-16 16:04:40] INFO custom_all_reduce.py:421: Using AiterCustomAllreduce for ROCm.
[36m(eager_allreduce pid=16199)[0m [aiter] import [module_aiter_enum] under /sgl-workspace/aiter/aiter/jit/module_aiter_enum.so[32m [repeated 3x across cluster][0m
[36m(eager_allreduce pid=16199)[0m [2025-12-16 16:04:40] INFO core.py:477: import [module_aiter_enum] under /sgl-workspace/aiter/aiter/jit/module_aiter_enum.so[32m [repeated 3x across cluster][0m
[36m(eager_allreduce pid=16199)[0m [aiter] import [module_custom_all_reduce] under /sgl-workspace/aiter/aiter/jit/module_custom_all_reduce.so[32m [repeated 3x across cluster][0m
[36m(eager_allreduce pid=16199)[0m [2025-12-16 16:04:41] INFO core.py:477: import [module_custom_all_reduce] under /sgl-workspace/aiter/aiter/jit/module_custom_all_reduce.so[32m [repeated 3x across cluster][0m
[36m(eager_allreduce pid=16199)[0m [2025-12-16 16:04:41] INFO custom_all_reduce.py:421: Using AiterCustomAllreduce for ROCm.[32m [repeated 3x across cluster][0m
/usr/lib/python3.10/subprocess.py:1072: ResourceWarning: subprocess 15958 is still running
  _warn("subprocess %s is still running" % self.pid,
ResourceWarning: Enable tracemalloc to get the object allocation traceback
/opt/venv/lib/python3.10/site-packages/ray/_private/node.py:1414: ResourceWarning: unclosed file <_io.TextIOWrapper name='/tmp/ray/session_2025-12-16_16-04-43_790962_13/logs/monitor.out' mode='a' encoding='utf-8'>
  self.start_monitor()
ResourceWarning: Enable tracemalloc to get the object allocation traceback
/opt/venv/lib/python3.10/site-packages/ray/_private/node.py:1414: ResourceWarning: unclosed file <_io.TextIOWrapper name='/tmp/ray/session_2025-12-16_16-04-43_790962_13/logs/monitor.err' mode='a' encoding='utf-8'>
  self.start_monitor()
ResourceWarning: Enable tracemalloc to get the object allocation traceback
/opt/venv/lib/python3.10/site-packages/ray/_private/node.py:1425: ResourceWarning: unclosed file <_io.TextIOWrapper name='/tmp/ray/session_2025-12-16_16-04-43_790962_13/logs/dashboard.err' mode='a' encoding='utf-8'>
  self.start_api_server(
ResourceWarning: Enable tracemalloc to get the object allocation traceback
/opt/venv/lib/python3.10/site-packages/ray/_private/node.py:1469: ResourceWarning: unclosed file <_io.TextIOWrapper name='/tmp/ray/session_2025-12-16_16-04-43_790962_13/logs/log_monitor.err' mode='a' encoding='utf-8'>
  self.start_log_monitor()
ResourceWarning: Enable tracemalloc to get the object allocation traceback
2025-12-16 16:04:44,695	INFO worker.py:1852 -- Started a local Ray instance.
[36m(eager_allreduce pid=31566)[0m [2025-12-16 16:04:53] INFO pynccl.py:83: sglang is using nccl==2.26.6
[36m(eager_allreduce pid=31568)[0m [aiter] import [module_aiter_enum] under /sgl-workspace/aiter/aiter/jit/module_aiter_enum.so
[36m(eager_allreduce pid=31568)[0m [2025-12-16 16:04:57] INFO core.py:477: import [module_aiter_enum] under /sgl-workspace/aiter/aiter/jit/module_aiter_enum.so
[36m(eager_allreduce pid=31568)[0m [aiter] import [module_custom_all_reduce] under /sgl-workspace/aiter/aiter/jit/module_custom_all_reduce.so
[36m(eager_allreduce pid=31568)[0m [2025-12-16 16:04:57] INFO core.py:477: import [module_custom_all_reduce] under /sgl-workspace/aiter/aiter/jit/module_custom_all_reduce.so
[36m(eager_allreduce pid=31568)[0m [2025-12-16 16:04:57] INFO custom_all_reduce.py:421: Using AiterCustomAllreduce for ROCm.
[36m(eager_allreduce pid=31568)[0m [2025-12-16 16:04:57] WARNING quick_all_reduce.py:126: Custom quick allreduce is disabled due to an unsupported world size: 6. Supported world sizes: [2, 4, 8].
[36m(eager_allreduce pid=31566)[0m [aiter] import [module_aiter_enum] under /sgl-workspace/aiter/aiter/jit/module_aiter_enum.so[32m [repeated 5x across cluster][0m
[36m(eager_allreduce pid=31566)[0m [2025-12-16 16:04:57] INFO core.py:477: import [module_aiter_enum] under /sgl-workspace/aiter/aiter/jit/module_aiter_enum.so[32m [repeated 5x across cluster][0m
[36m(eager_allreduce pid=31563)[0m [aiter] import [module_custom_all_reduce] under /sgl-workspace/aiter/aiter/jit/module_custom_all_reduce.so[32m [repeated 5x across cluster][0m
[36m(eager_allreduce pid=31563)[0m [2025-12-16 16:04:57] INFO core.py:477: import [module_custom_all_reduce] under /sgl-workspace/aiter/aiter/jit/module_custom_all_reduce.so[32m [repeated 5x across cluster][0m
[36m(eager_allreduce pid=31563)[0m [2025-12-16 16:04:57] INFO custom_all_reduce.py:421: Using AiterCustomAllreduce for ROCm.[32m [repeated 5x across cluster][0m
[36m(eager_allreduce pid=31565)[0m [2025-12-16 16:04:57] WARNING quick_all_reduce.py:126: Custom quick allreduce is disabled due to an unsupported world size: 6. Supported world sizes: [2, 4, 8].[32m [repeated 5x across cluster][0m
/usr/lib/python3.10/subprocess.py:1072: ResourceWarning: subprocess 31337 is still running
  _warn("subprocess %s is still running" % self.pid,
ResourceWarning: Enable tracemalloc to get the object allocation traceback
/opt/venv/lib/python3.10/site-packages/ray/_private/node.py:1414: ResourceWarning: unclosed file <_io.TextIOWrapper name='/tmp/ray/session_2025-12-16_16-05-00_776813_13/logs/monitor.out' mode='a' encoding='utf-8'>
  self.start_monitor()
ResourceWarning: Enable tracemalloc to get the object allocation traceback
/opt/venv/lib/python3.10/site-packages/ray/_private/node.py:1414: ResourceWarning: unclosed file <_io.TextIOWrapper name='/tmp/ray/session_2025-12-16_16-05-00_776813_13/logs/monitor.err' mode='a' encoding='utf-8'>
  self.start_monitor()
ResourceWarning: Enable tracemalloc to get the object allocation traceback
/opt/venv/lib/python3.10/site-packages/ray/_private/node.py:1425: ResourceWarning: unclosed file <_io.TextIOWrapper name='/tmp/ray/session_2025-12-16_16-05-00_776813_13/logs/dashboard.err' mode='a' encoding='utf-8'>
  self.start_api_server(
ResourceWarning: Enable tracemalloc to get the object allocation traceback
/opt/venv/lib/python3.10/site-packages/ray/_private/node.py:1469: ResourceWarning: unclosed file <_io.TextIOWrapper name='/tmp/ray/session_2025-12-16_16-05-00_776813_13/logs/log_monitor.err' mode='a' encoding='utf-8'>
  self.start_log_monitor()
ResourceWarning: Enable tracemalloc to get the object allocation traceback
2025-12-16 16:05:01,670	INFO worker.py:1852 -- Started a local Ray instance.
[36m(eager_allreduce pid=47191)[0m [2025-12-16 16:05:09] INFO pynccl.py:83: sglang is using nccl==2.26.6

==========================================
End time: 2025-12-16 10:05:14 CST
Exit code: 137
Result: FAILED
==========================================
