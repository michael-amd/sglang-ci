===================================================
PD Test Execution Started: Sun Oct 19 11:09:06 PM CDT 2025
===================================================
[pd-test] ==========================================
[pd-test] SGLang PD Docker-based Test Runner
[pd-test] ==========================================
[pd-test] Model: /data2/models/amd-DeepSeek-R1-MXFP4-Preview
[pd-test] Model Name: DeepSeek-R1-MXFP4-Preview
[pd-test] Docker Image: rocm/sgl-dev:v0.5.3.post3-rocm700-mi35x-20251019
[pd-test] Hardware: mi35x
[pd-test] Docker Tag: v0.5.3.post3-rocm700-mi35x-20251019
[pd-test] Log Directory: /mnt/raid/michael/sglang-ci/test/pd/pd_log/mi35x/v0.5.3.post3-rocm700-mi35x-20251019
[pd-test] IP: 10.235.26.27
[pd-test]
[pd-test] Checking for existing containers...

[pd-test] ==========================================
[pd-test] Cleaning up Docker containers...
[pd-test] ==========================================
[pd-test] Cleanup complete.
===================================================
PD Test Execution Ended: Sun Oct 19 11:09:09 PM CDT 2025 (Exit Code: 0)
===================================================
[pd-test] ==========================================
[pd-test] Step 1: Starting Load Balancer/Router...
[pd-test] ==========================================
[pd-test] Router container started
[pd-test] Waiting 10 seconds for router to initialize...
[pd-test] ✓ Router started successfully

[pd-test] ==========================================
[pd-test] Step 2: Starting Prefill Server (GPUs 0-3)...
[pd-test] ==========================================
[pd-test] Prefill Server container started
[pd-test] Waiting 60 seconds for prefill server to initialize...
[pd-test] ✓ Prefill Server started successfully

[pd-test] ==========================================
[pd-test] Step 3: Starting Decode Server (GPUs 4-7)...
[pd-test] ==========================================
[pd-test] Decode Server container started
[pd-test] Waiting 60 seconds for decode server to initialize...
[pd-test] ✓ Decode Server started successfully

[pd-test] ==========================================
[pd-test] Step 4: Waiting for services to be healthy...
[pd-test] ==========================================
[pd-test] Waiting additional 30 seconds...
[pd-test] Checking health endpoints for all services...
[pd-test] Attempt 1/60...
[pd-test]   ✓ Prefill server is healthy
[pd-test]   ⧗ Decode server not ready yet...
[pd-test] Attempt 2/60...
[pd-test]   ⧗ Decode server not ready yet...
[pd-test] Attempt 3/60...
[pd-test]   ⧗ Decode server not ready yet...
[pd-test] Attempt 4/60...
[pd-test]   ⧗ Decode server not ready yet...
[pd-test] Attempt 5/60...
[pd-test]   ⧗ Decode server not ready yet...
[pd-test] Attempt 6/60...
[pd-test]   ⧗ Decode server not ready yet...
[pd-test] Attempt 7/60...
[pd-test]   ⧗ Decode server not ready yet...
[pd-test] Attempt 8/60...
[pd-test]   ⧗ Decode server not ready yet...
[pd-test] Attempt 9/60...
[pd-test]   ⧗ Decode server not ready yet...
[pd-test] Attempt 10/60...
[pd-test]   ⧗ Decode server not ready yet...
[pd-test] Attempt 11/60...
[pd-test]   ⧗ Decode server not ready yet...
[pd-test] Attempt 12/60...
[pd-test]   ⧗ Decode server not ready yet...
[pd-test] Attempt 13/60...
[pd-test]   ⧗ Decode server not ready yet...
[pd-test] Attempt 14/60...
[pd-test]   ⧗ Decode server not ready yet...
[pd-test] Attempt 15/60...
[pd-test]   ⧗ Decode server not ready yet...
[pd-test] Attempt 16/60...
[pd-test]   ⧗ Decode server not ready yet...
[pd-test] Attempt 17/60...
[pd-test]   ⧗ Decode server not ready yet...
[pd-test] Attempt 18/60...
[pd-test]   ⧗ Decode server not ready yet...
[pd-test] Attempt 19/60...
[pd-test]   ⧗ Decode server not ready yet...
[pd-test] Attempt 20/60...
[pd-test]   ⧗ Decode server not ready yet...
[pd-test] Attempt 21/60...
[pd-test]   ⧗ Decode server not ready yet...
[pd-test] Attempt 22/60...
[pd-test]   ⧗ Decode server not ready yet...
[pd-test] Attempt 23/60...
[pd-test]   ✓ Decode server is healthy
[pd-test]   ⧗ Router not ready yet...
[pd-test] Attempt 24/60...
[pd-test]   ⧗ Router not ready yet...
[pd-test] Attempt 25/60...
[pd-test]   ⧗ Router not ready yet...
[pd-test] Attempt 26/60...
[pd-test]   ⧗ Router not ready yet...
[pd-test] Attempt 27/60...
[pd-test]   ⧗ Router not ready yet...
[pd-test] Attempt 28/60...
[pd-test]   ⧗ Router not ready yet...
[pd-test] Attempt 29/60...
[pd-test]   ✓ Router is healthy
[pd-test] All services report healthy. Performing functional test...
[pd-test] ✓ Functional test passed - all services fully operational!

[pd-test] ==========================================
[pd-test] Step 5: Running Tests...
[pd-test] ==========================================
[pd-test] Test 1: Health Check
[pd-test] ✓ Health check passed

[pd-test] Test 2: Model Info
[pd-test] ✓ Model info passed

[pd-test] Test 3: Simple Completion
[pd-test] ✓ Simple completion passed

[pd-test] Test 4: Code Generation
[pd-test] ✓ Code generation passed

[pd-test] Test 6: GSM8K Accuracy Test
[pd-test] Running GSM8K benchmark (200 questions, parallel 32, 5-shot)...
[pd-test] Using official implementation (bench_gsm8k_pd.py based on sglang/benchmark/gsm8k/bench_sglang.py)
[pd-test] Note: Using parallel=32 instead of 128 to avoid PD timeout issues with long prompts
[pd-test] ✓ GSM8K test completed - Accuracy: 0.9700 (Duration: 231s)

[pd-test] Collecting logs from Docker containers...
[pd-test] ==========================================
[pd-test] Creating Test Summary
[pd-test] ==========================================
SGLang PD Disaggregation Test Summary
======================================

Docker Tag: v0.5.3.post3-rocm700-mi35x-20251019
Hardware: mi35x
Model: DeepSeek-R1-MXFP4-Preview
Model Path: /data2/models/amd-DeepSeek-R1-MXFP4-Preview
Docker Image: rocm/sgl-dev:v0.5.3.post3-rocm700-mi35x-20251019

Configuration:
- IP Address: 10.235.26.27
- Prefill Server: Port 30025, GPUs 0-3, TP=4
- Decode Server: Port 30026, GPUs 4-7, TP=4
- Load Balancer: Port 30028
- Network: Loopback (lo)
- Execution: Docker containers

Setup Steps (with runtime):
- Step 1 - Router Startup: 10s
- Step 2 - Prefill Server Startup: 60s
- Step 3 - Decode Server Startup: 61s
- Step 4 - Health Check Wait: 178s

Test Results (with runtime):
- Test 1 - Health Check: PASS (0s)
- Test 2 - Model Info: PASS (0s)
- Test 3 - Simple Completion: PASS (2s)
- Test 4 - Code Generation: PASS (2s)
- Test 6 - GSM8K Accuracy: 0.9700 [PASS] (231s)

Timing Summary:
- Total Test Runtime: 231s
- Setup Time (Steps 1-4): 309s
- GSM8K Test Duration: 231s
- GSM8K Questions per Second: 0.87
- GSM8K Parallelism: 32 concurrent requests

Log Files:
- Load Balancer: /mnt/raid/michael/sglang-ci/test/pd/pd_log/mi35x/v0.5.3.post3-rocm700-mi35x-20251019/load_balance.log
- Prefill Server: /mnt/raid/michael/sglang-ci/test/pd/pd_log/mi35x/v0.5.3.post3-rocm700-mi35x-20251019/prefill.log
- Decode Server: /mnt/raid/michael/sglang-ci/test/pd/pd_log/mi35x/v0.5.3.post3-rocm700-mi35x-20251019/decode.log
- GSM8K Results: /mnt/raid/michael/sglang-ci/test/pd/pd_log/mi35x/v0.5.3.post3-rocm700-mi35x-20251019/test_gsm8k.log
- Main Execution: /mnt/raid/michael/sglang-ci/test/pd/pd_log/mi35x/v0.5.3.post3-rocm700-mi35x-20251019/main_execution.log

Test completed in nightly mode (Docker-based).

[pd-test] ==========================================
[pd-test] Tests complete! Logs saved to: /mnt/raid/michael/sglang-ci/test/pd/pd_log/mi35x/v0.5.3.post3-rocm700-mi35x-20251019
[pd-test] Main execution log: /mnt/raid/michael/sglang-ci/test/pd/pd_log/mi35x/v0.5.3.post3-rocm700-mi35x-20251019/main_execution.log
[pd-test] ==========================================
[pd-test] ✓ All tests PASSED

[pd-test] ==========================================
[pd-test] Cleaning up Docker containers...
[pd-test] ==========================================
[pd-test] Collecting final router logs...
[pd-test] Collecting final prefill logs...
[pd-test] Collecting final decode logs...
sglang-pd-router
sglang-pd-prefill
sglang-pd-decode
sglang-pd-router
sglang-pd-prefill
sglang-pd-decode
[pd-test] Cleanup complete.
===================================================
PD Test Execution Ended: Sun Oct 19 11:18:27 PM CDT 2025 (Exit Code: 0)
===================================================
