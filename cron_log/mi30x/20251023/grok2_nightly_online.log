[nightly] ==========================================
[nightly] SGL Nightly Benchmark Started
[nightly] ==========================================
[nightly] Command: perf_nightly.sh --model=grok2 --model-path=/mnt/raid/models/huggingface/grok-2 --tokenizer-path=/mnt/raid/models/huggingface/alvarobartt--grok-2-tokenizer --mode=online --hardware=mi30x --teams-webhook-url=https://default3dd8961fe4884e608e11a82d994e18.3d.environment.api.powerplatform.com:443/powerautomate/automations/direct/workflows/2115793fe51a4371bcedd8ff67ff0418/triggers/manual/paths/invoke?api-version=1&sp=%2Ftriggers%2Fmanual%2Frun&sv=1.0&sig=hzr6aH40CKrySSK64uAnsmVIR8ynAkIRTH65z-wqxNA
[nightly] Start time: 2025-10-23 13:45:01 PDT
[nightly] Machine: dell300x-pla-t10-23
[nightly] Working directory: /mnt/raid/michael/sglang-ci
[nightly] Script location: /mnt/raid/michael/sglang-ci/perf_nightly.sh
[nightly] Process ID: 838057
[nightly] ==========================================

[nightly] Runtime Environment:
[nightly] User: amd | Groups: amd video users... | Docker: /usr/bin/docker
[nightly] Testing Docker daemon access...
[nightly] Docker daemon accessible - proceeding...
[nightly] Teams webhook URL provided via command line - notifications enabled
[nightly] Custom model path provided: /mnt/raid/models/huggingface/grok-2
[nightly] Custom tokenizer path provided: /mnt/raid/models/huggingface/alvarobartt--grok-2-tokenizer
[nightly] Using rocm700 for grok2 on mi30x hardware
[nightly] Hardware: mi30x, ROCM Version: rocm700
[nightly] Model: grok2, Mode(s): online
[nightly] Created process lock: /tmp/perf_nightly_grok2.lock
[nightly] GPU is busy. Attempting to stop running Docker containers...
[nightly] Stopping running containers: e502e834cd2f
[nightly] Waiting 15s for GPU to become idle...
[nightly] WARN: GPU may still be busy, but proceeding as requested.
[nightly] Searching for non-SRT images for grok2 for the last 1 days...
[nightly] Searching for non-SRT mi30x image in 'rocm/sgl-dev' for date 20251023...
[nightly] Found candidate tag for day -0: v0.5.3.post3-rocm700-mi30x-20251023
[nightly] Pull attempt 1/3 for rocm/sgl-dev:v0.5.3.post3-rocm700-mi30x-20251023...
v0.5.3.post3-rocm700-mi30x-20251023: Pulling from rocm/sgl-dev
660ffc76f83b: Already exists
8f15127cc838: Already exists
9b15895e3240: Already exists
f9b093ef803e: Already exists
7871d920fb0f: Already exists
7935d8c4e26c: Already exists
a32765e78010: Already exists
7fc751a2ed3a: Already exists
980be016a223: Already exists
9e1a971876ec: Already exists
ec6812b374e9: Already exists
01b887f14943: Already exists
844c30750327: Already exists
2682f0d8340c: Already exists
4f4fb700ef54: Already exists
349b8c8a8418: Already exists
d0b1657b26f5: Already exists
45b70560bebf: Already exists
4f4fb700ef54: Already exists
b18067367790: Already exists
80e4388c8594: Already exists
43bd5f89e157: Already exists
4f4e25c713a5: Already exists
fa9b244e8ec3: Already exists
4f4fb700ef54: Already exists
4f4fb700ef54: Already exists
802ff7b676ec: Already exists
4f4fb700ef54: Already exists
91c970c997c5: Already exists
c7b1c2221fca: Already exists
f741376ff6a1: Already exists
d9b88c1e947d: Already exists
0e6681539f16: Already exists
95b1c4732b41: Pulling fs layer
4f4fb700ef54: Pulling fs layer
bb7b66f321c1: Pulling fs layer
6c53399f1cd2: Pulling fs layer
9debbb327683: Pulling fs layer
1718b9f3bdf4: Pulling fs layer
245d2225c4f5: Pulling fs layer
6c53399f1cd2: Waiting
96b578812f5d: Pulling fs layer
1718b9f3bdf4: Waiting
de08c4f5077f: Pulling fs layer
1024053cf66f: Pulling fs layer
9debbb327683: Waiting
223abe766503: Pulling fs layer
245d2225c4f5: Waiting
de08c4f5077f: Waiting
df70bd424580: Pulling fs layer
1024053cf66f: Waiting
afbc58aceb32: Pulling fs layer
df70bd424580: Waiting
223abe766503: Waiting
4ea5dbf68084: Pulling fs layer
4ea5dbf68084: Waiting
1e92d858d100: Pulling fs layer
0c2deb6d1386: Pulling fs layer
afbc58aceb32: Waiting
1e92d858d100: Waiting
0c2deb6d1386: Waiting
4f4fb700ef54: Verifying Checksum
4f4fb700ef54: Download complete
95b1c4732b41: Download complete
bb7b66f321c1: Verifying Checksum
bb7b66f321c1: Download complete
95b1c4732b41: Pull complete
4f4fb700ef54: Pull complete
bb7b66f321c1: Pull complete
6c53399f1cd2: Verifying Checksum
6c53399f1cd2: Download complete
6c53399f1cd2: Pull complete
9debbb327683: Verifying Checksum
9debbb327683: Download complete
96b578812f5d: Verifying Checksum
96b578812f5d: Download complete
9debbb327683: Pull complete
1718b9f3bdf4: Verifying Checksum
1718b9f3bdf4: Download complete
1024053cf66f: Verifying Checksum
1024053cf66f: Download complete
223abe766503: Download complete
de08c4f5077f: Verifying Checksum
de08c4f5077f: Download complete
df70bd424580: Verifying Checksum
df70bd424580: Download complete
4ea5dbf68084: Verifying Checksum
4ea5dbf68084: Download complete
1718b9f3bdf4: Pull complete
1e92d858d100: Verifying Checksum
1e92d858d100: Download complete
0c2deb6d1386: Verifying Checksum
0c2deb6d1386: Download complete
245d2225c4f5: Verifying Checksum
245d2225c4f5: Download complete
afbc58aceb32: Verifying Checksum
afbc58aceb32: Download complete
245d2225c4f5: Pull complete
96b578812f5d: Pull complete
de08c4f5077f: Pull complete
1024053cf66f: Pull complete
223abe766503: Pull complete
df70bd424580: Pull complete
afbc58aceb32: Pull complete
4ea5dbf68084: Pull complete
1e92d858d100: Pull complete
0c2deb6d1386: Pull complete
Digest: sha256:9bf2a66cd571d1efdc6d6356ec195e99cb874b9719b53363e6921fb133c5af91
Status: Downloaded newer image for rocm/sgl-dev:v0.5.3.post3-rocm700-mi30x-20251023
docker.io/rocm/sgl-dev:v0.5.3.post3-rocm700-mi30x-20251023
[nightly] Successfully pulled image: rocm/sgl-dev:v0.5.3.post3-rocm700-mi30x-20251023
[nightly] Successfully obtained image for date 20251023: rocm/sgl-dev:v0.5.3.post3-rocm700-mi30x-20251023
[nightly] Found 1 valid image(s) to run benchmarks on:
[nightly]   - rocm/sgl-dev:v0.5.3.post3-rocm700-mi30x-20251023

[nightly] ==========================================
[nightly] Starting benchmarks for image: rocm/sgl-dev:v0.5.3.post3-rocm700-mi30x-20251023
[nightly] ==========================================
[nightly] Checking GPU status before starting benchmarks for rocm/sgl-dev:v0.5.3.post3-rocm700-mi30x-20251023...
[nightly] GPU is busy. Attempting to stop running Docker containers...
[nightly] Stopping running containers: 78ae10a8f8c2
[nightly] Waiting 15s for GPU to become idle...
[nightly] WARN: GPU may still be busy, but proceeding as requested.
[nightly] INFO: Found 0/15 completed runs for rocm/sgl-dev:v0.5.3.post3-rocm700-mi30x-20251023 (online). Proceeding with benchmarks.
[nightly] Using Docker image: rocm/sgl-dev:v0.5.3.post3-rocm700-mi30x-20251023
[nightly] Container name: sgl-dev_v0.5.3.post3-rocm700-mi30x-20251023
[nightly] Creating container sgl-dev_v0.5.3.post3-rocm700-mi30x-20251023
fc6aee6e60a00eecd111cda597b340d309180652bb2ba9b9d112b73b3da4a618
[nightly] === Starting benchmark execution ===
[nightly] === Starting nightly GROK2 online benchmark ===
[nightly] Launching grok_perf_online_csv.sh inside sgl-dev_v0.5.3.post3-rocm700-mi30x-20251023
[nightly] Adding --model-type=grok2 flag for Grok 2 benchmark
[nightly] Adding --tokenizer='/mnt/raid/models/huggingface/alvarobartt--grok-2-tokenizer' flag for Grok 2 benchmark
[online] Using Grok 2 configuration
[online] Using default Grok 2 tokenizer: /mnt/raid/models/huggingface/alvarobartt--grok-2-tokenizer
[online] Script started at: 2025-10-23 13:48:02 PDT
Scanning existing logs to check if all benchmarks are already complete...
Checking GSM8K log status...
Missing: GSM8K log file (/mnt/raid/michael/sglang-ci/online/GROK2/v0.5.3.post3-rocm700-mi30x-20251023_GROK2_FP8_online/sglang_client_log_GROK2_gsm8k_aiter.log)
Checking client benchmark logs...
Scan complete: 0/15 client benchmark runs are complete.
❌ Missing or incomplete client benchmark runs.
❌ GSM8K benchmark is missing, empty, or incomplete.
Server startup required.
Starting benchmarks using aiter backend...
[online] Using Grok2 environment: RCCL_MSCCL_ENABLE=0 SGLANG_USE_AITER=1 SGLANG_INT4_WEIGHT=0
[online] Launching backend=aiter for grok2
[online] Waiting for server to be ready (timeout: 600s)...
[online] Still waiting... (10s elapsed)
[online] Still waiting... (20s elapsed)
[online] Still waiting... (30s elapsed)
[online] Still waiting... (40s elapsed)
/mnt/raid/michael/sglang-ci/grok_perf_online_csv.sh: line 420:    30 Killed                  env RCCL_MSCCL_ENABLE=0 SGLANG_USE_AITER=1 SGLANG_INT4_WEIGHT=0 python3 -m sglang.launch_server --model '/mnt/raid/models/huggingface/grok-2' --tokenizer-path '/mnt/raid/models/huggingface/alvarobartt--grok-2-tokenizer' --tp 8 --quantization fp8 --trust-remote-code --attention-backend aiter --mem-fraction-static 0.85 --watchdog-timeout 600 > '/mnt/raid/michael/sglang-ci/online/GROK2/v0.5.3.post3-rocm700-mi30x-20251023_GROK2_FP8_online/server_output_aiter.log' 2>&1
[online] Still waiting... (50s elapsed)
[online] Still waiting... (60s elapsed)
[online] Still waiting... (70s elapsed)
[online] Still waiting... (80s elapsed)
[online] Still waiting... (90s elapsed)
[online] Still waiting... (100s elapsed)
[online] Still waiting... (110s elapsed)
[online] Still waiting... (120s elapsed)
[online] Still waiting... (130s elapsed)
[online] Still waiting... (140s elapsed)
[online] Still waiting... (150s elapsed)
[online] Still waiting... (160s elapsed)
[online] Still waiting... (170s elapsed)
[online] Still waiting... (180s elapsed)
[online] Still waiting... (190s elapsed)
[online] Still waiting... (200s elapsed)
[online] Still waiting... (210s elapsed)
[online] Still waiting... (220s elapsed)
[online] Still waiting... (230s elapsed)
[online] Still waiting... (240s elapsed)
[online] Still waiting... (250s elapsed)
[online] Still waiting... (260s elapsed)
[online] Still waiting... (270s elapsed)
[online] Still waiting... (280s elapsed)
[online] Still waiting... (290s elapsed)
[online] Still waiting... (300s elapsed)
[online] Still waiting... (310s elapsed)
[online] Still waiting... (320s elapsed)
[online] Still waiting... (330s elapsed)
[online] Still waiting... (340s elapsed)
[online] Still waiting... (350s elapsed)
[online] Still waiting... (360s elapsed)
[online] Still waiting... (370s elapsed)
[online] Still waiting... (380s elapsed)
[online] Still waiting... (390s elapsed)
[online] Still waiting... (400s elapsed)
[online] Still waiting... (410s elapsed)
[online] Still waiting... (420s elapsed)
[online] Still waiting... (430s elapsed)
[online] Still waiting... (440s elapsed)
[online] Still waiting... (450s elapsed)
[online] Still waiting... (460s elapsed)
[online] Still waiting... (470s elapsed)
[online] Still waiting... (480s elapsed)
[online] Still waiting... (490s elapsed)
[online] Still waiting... (500s elapsed)
[online] Still waiting... (510s elapsed)
[online] Still waiting... (520s elapsed)
[online] Still waiting... (530s elapsed)
[online] Still waiting... (540s elapsed)
[online] Still waiting... (550s elapsed)
[online] Still waiting... (560s elapsed)
[online] Still waiting... (570s elapsed)
[online] Still waiting... (580s elapsed)
[online] Still waiting... (590s elapsed)
[online] ERROR: Server failed to start within 600 seconds
[online] Last 50 lines of server log:
  File "/sgl-workspace/sglang/python/sglang/srt/models/grok.py", line 545, in __init__
    self.self_attn = Grok1Attention(
  File "/sgl-workspace/sglang/python/sglang/srt/models/grok.py", line 401, in __init__
    self.rotary_emb = ScalingRotaryEmbedding(
  File "/sgl-workspace/sglang/python/sglang/srt/models/grok.py", line 258, in __init__
    super().__init__(
  File "/sgl-workspace/sglang/python/sglang/srt/layers/rotary_embedding.py", line 134, in __init__
    .view(self.max_position_embeddings, 1, 1, half_rotary)
  File "/opt/venv/lib/python3.10/site-packages/torch/utils/_device.py", line 103, in __torch_function__
    return func(*args, **kwargs)
RuntimeError: shape '[8192, 1, 1, 64]' is invalid for input of size 8388608

[2025-10-23 13:48:45 TP6] Scheduler hit an exception: Traceback (most recent call last):
  File "/sgl-workspace/sglang/python/sglang/srt/managers/scheduler.py", line 2747, in run_scheduler_process
    scheduler = Scheduler(
  File "/sgl-workspace/sglang/python/sglang/srt/managers/scheduler.py", line 311, in __init__
    self.tp_worker = TpModelWorker(
  File "/sgl-workspace/sglang/python/sglang/srt/managers/tp_worker.py", line 235, in __init__
    self._model_runner = ModelRunner(
  File "/sgl-workspace/sglang/python/sglang/srt/model_executor/model_runner.py", line 318, in __init__
    self.initialize(min_per_gpu_memory)
  File "/sgl-workspace/sglang/python/sglang/srt/model_executor/model_runner.py", line 390, in initialize
    self.load_model()
  File "/sgl-workspace/sglang/python/sglang/srt/model_executor/model_runner.py", line 887, in load_model
    self.model = get_model(
  File "/sgl-workspace/sglang/python/sglang/srt/model_loader/__init__.py", line 28, in get_model
    return loader.load_model(
  File "/sgl-workspace/sglang/python/sglang/srt/model_loader/loader.py", line 588, in load_model
    model = _initialize_model(
  File "/sgl-workspace/sglang/python/sglang/srt/model_loader/loader.py", line 260, in _initialize_model
    return model_class(**kwargs)
  File "/sgl-workspace/sglang/python/sglang/srt/models/grok.py", line 834, in __init__
    self.model = Grok1Model(
  File "/sgl-workspace/sglang/python/sglang/srt/models/grok.py", line 721, in __init__
    [
  File "/sgl-workspace/sglang/python/sglang/srt/models/grok.py", line 722, in <listcomp>
    Grok1DecoderLayer(
  File "/sgl-workspace/sglang/python/sglang/srt/models/grok.py", line 545, in __init__
    self.self_attn = Grok1Attention(
  File "/sgl-workspace/sglang/python/sglang/srt/models/grok.py", line 401, in __init__
    self.rotary_emb = ScalingRotaryEmbedding(
  File "/sgl-workspace/sglang/python/sglang/srt/models/grok.py", line 258, in __init__
    super().__init__(
  File "/sgl-workspace/sglang/python/sglang/srt/layers/rotary_embedding.py", line 134, in __init__
    .view(self.max_position_embeddings, 1, 1, half_rotary)
  File "/opt/venv/lib/python3.10/site-packages/torch/utils/_device.py", line 103, in __torch_function__
    return func(*args, **kwargs)
RuntimeError: shape '[8192, 1, 1, 64]' is invalid for input of size 8388608

[2025-10-23 13:48:45] Received sigquit from a child process. It usually means the child failed.
[nightly] === Online benchmark dispatched for GROK2; check logs in sgl-dev_v0.5.3.post3-rocm700-mi30x-20251023 ===
[nightly] === Starting post-processing (CSV processing, plot generation, Teams notifications) ===
[nightly] Processing online CSV data and generating plots... Logs will be saved to /mnt/raid/michael/sglang-ci/online/GROK2/v0.5.3.post3-rocm700-mi30x-20251023_GROK2_FP8_online/process_and_generate_online_plots.log
[nightly] Using plot date from image tag: 20251023
[nightly] Sending Teams notification for grok2 online plots...
[nightly] Adding benchmark date to Teams notification: 20251023
[nightly] Teams notification using plot directory: /mnt/raid/michael/sglang-ci/plots_server
[nightly] Using GitHub upload for plot images (repo: ROCm/sglang-ci)
[nightly] Images will be stored in main branch with structure: plot/mi30x/model/mode/filename.png
[nightly] Including intelligent analysis (7 days lookback)
🐙 GitHub upload mode: Images will be uploaded to ROCm/sglang-ci
🐙 GitHub upload mode: Images will be uploaded to GitHub and embedded in Teams
📁 Plot directory: /mnt/raid/michael/sglang-ci/plots_server
🗂️  Benchmark directory: /mnt/raid/michael/sglang-ci
   🔍 Uploading 20251023_GROK2_online_standard.png to GitHub...
   📋 Log branch already exists
   📄 Creating new file: plot/mi30x/GROK2/online/20251023_GROK2_online_standard.png
   ✅ Uploaded to GitHub (log branch): 20251023_GROK2_online_standard.png
   🔗 GitHub URL: https://raw.githubusercontent.com/ROCm/sglang-ci/log/plot/mi30x/GROK2/online/20251023_GROK2_online_standard.png
🔍 Discovered 1 plot file(s) for grok2 online
   - 20251023_GROK2_online_standard.png -> ✅ uploaded to GitHub
🔍 Analyzing benchmark results for accuracy and performance...
   Found timing_summary log for grok2 online on 20251023: timing_summary_20251023_134802.log
   Found timing_summary log for grok2 online on 20251023: timing_summary_20251023_134802.log
   Found timing_summary log for grok2 online on 20251023: timing_summary_20251023_134802.log
🔍 Sending adaptive card with 1 image(s) hosted on GitHub
📊 Total payload size: 0.00MB
   📷 Image URL: https://raw.githubusercontent.com/ROCm/sglang-ci/log/plot/mi30x/GROK2/online/20251023_GROK2_online_standard.png
   💾 Debug: Card JSON saved to /tmp/teams_card_debug.json
✅ Successfully sent Teams notification for grok2 online plots
   (Power Automate flow accepted - message processing asynchronously)
🎉 Teams notification sent successfully! (with intelligent analysis)
[nightly] Teams notification sent successfully for grok2 online
[nightly] === Online post-processing completed for GROK2 ===
[nightly] ==========================================
[nightly] Completed benchmarks for image: rocm/sgl-dev:v0.5.3.post3-rocm700-mi30x-20251023
[nightly] Stopping container sgl-dev_v0.5.3.post3-rocm700-mi30x-20251023 to release resources...
[nightly] ==========================================
[nightly] ==========================================
[nightly] All benchmarks completed for 1 image(s)
[nightly] ==========================================
[nightly] Cleaning up process lock...
